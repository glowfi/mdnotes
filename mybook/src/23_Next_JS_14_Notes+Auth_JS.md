# Next JS 14 Auth.js and Notes app

#### Next JS Must know concept

-   Routing and Navigation <Link/>
-   Metadata
-   Tailwind CSS
-   \<Image\/\>
-   client side vs server side
-   server actions GET POST PUT DELETE
-   Suspsense , streaming [formstatus pending ,react Suspsense]
-   Caching [Route caching , Client Caching]
-   Static and Dynamic rendering [export const dynamic, cache:no-cache, next:{revalidate:3600}]
-   Middleware
-   Production Build

#### Install

```sh
pnpm install prisma --save-dev
pnpm install @prisma/client
pnpm dlx prisma init
pnpm dlx shadcn-ui@latest init
pnpm dlx shadcn-ui@latest add sheet dropdown-menu input button @radix-ui/react-dropdown-menu card select label textarea table checkbox dialog
pnpm add next-themes
pnpm i @tanstack/react-table
pnpm add next-auth@beta
```

### ENV

```
DATABASE_URL = "file:./dev.db"
```

### Prisma models

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Task {
  id String @id @default(uuid())
  content String
  createdAt DateTime @default(now())
  completed Boolean @default(false)
}
```

### Migrate Dev

```sh
pnpm dlx prisma migrate dev
```

### layout.tsx (Home Page)

```tsx
import Navbar from '@/components/navbar';
import { ThemeProvider } from '@/components/theme-provider';
import type { Metadata } from 'next';
import './globals.css';

export const metadata: Metadata = {
    title: 'Create Next App',
    description: 'Generated by create next app'
};

export default function RootLayout({
    children
}: Readonly<{
    children: React.ReactNode;
}>) {
    return (
        <html lang="en">
            <body>
                <ThemeProvider
                    attribute="class"
                    defaultTheme="system"
                    enableSystem
                    disableTransitionOnChange
                >
                    <Navbar />
                    {children}
                </ThemeProvider>
            </body>
        </html>
    );
}
```

### page.tsx (Home Page)

```tsx
import get_all_notes from '@/actions/get_all_notes';
import { AllPosts } from '@/components/allposts';
import { NoteForm } from '@/components/noteform';

const HomePage = async () => {
    const allPosts = await get_all_notes();

    return (
        <div className="container flex flex-col justify-center items-center h-dvh">
            <NoteForm />
            <AllPosts data={allPosts} />
        </div>
    );
};

export default HomePage;
```

> src/components/themeswitcher.tsx

```tsx
'use client';

import { Moon, Sun } from 'lucide-react';
import { useTheme } from 'next-themes';

import { Button } from '@/components/ui/button';
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuTrigger
} from '@/components/ui/dropdown-menu';

export function ModeToggle() {
    const { setTheme } = useTheme();

    return (
        <DropdownMenu>
            <DropdownMenuTrigger asChild>
                <Button variant="outline" size="icon">
                    <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
                    <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
                    <span className="sr-only">Toggle theme</span>
                </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent align="end">
                <DropdownMenuItem onClick={() => setTheme('light')}>
                    Light
                </DropdownMenuItem>
                <DropdownMenuItem onClick={() => setTheme('dark')}>
                    Dark
                </DropdownMenuItem>
                <DropdownMenuItem onClick={() => setTheme('system')}>
                    System
                </DropdownMenuItem>
            </DropdownMenuContent>
        </DropdownMenu>
    );
}
```

> src/components/allposts.tsx

```tsx
import {
    Table,
    TableBody,
    TableCell,
    TableHead,
    TableHeader,
    TableRow
} from '@/components/ui/table';
import Act from './act';

export type Task = {
    id: string;
    content: string;
    createdAt: Date;
    completed: Date;
};

export function AllPosts({ data }: any) {
    if (data.length == 0) {
        return <h2 className="mt-8 font-medium text-lg">No tasks to show</h2>;
    }
    return (
        <>
            <h1 className="mt-5">Task List</h1>

            <Table>
                <TableHeader>
                    <TableRow className="h-24 text-center">
                        <TableHead>Content</TableHead>
                        <TableHead>Completed</TableHead>
                        <TableHead>Actions</TableHead>
                    </TableRow>
                </TableHeader>
                <TableBody>
                    {data.map((currTask: any) => (
                        <TableRow key={currTask.id}>
                            <TableCell className="font-medium">
                                {currTask.content}
                            </TableCell>
                            <TableCell>
                                {currTask.completed.toString()}
                            </TableCell>
                            <TableCell>
                                <Act data={currTask} />
                            </TableCell>
                        </TableRow>
                    ))}
                </TableBody>
            </Table>
        </>
    );
}
```

> src/components/act.tsx

```tsx
'use client';
import { Button } from './ui/button';

import delete_note from '@/actions/delete_note';
import update_note from '@/actions/update_note';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogHeader,
    DialogTitle,
    DialogTrigger
} from '@/components/ui/dialog';
import { useRef } from 'react';
import { Textarea } from './ui/textarea';

const Act = (data: any) => {
    let currTask = data.data;
    const updRef = useRef(null);

    return (
        <div className="flex gap-3">
            <form action="">
                <Dialog>
                    <DialogTrigger asChild>
                        <Button variant="secondary">Edit</Button>
                    </DialogTrigger>
                    <DialogContent className="sm:max-w-[425px]">
                        <DialogHeader>
                            <DialogTitle>Edit profile</DialogTitle>
                            <DialogDescription>
                                Make changes to your content.
                            </DialogDescription>
                        </DialogHeader>
                        <div className="grid gap-4 py-4">
                            <form
                                ref={updRef}
                                action={async (formData: FormData) => {
                                    await update_note(formData, currTask.id);
                                    // @ts-ignore
                                    updRef.current?.reset();
                                }}
                            >
                                <Textarea
                                    placeholder="Type your message here."
                                    name="content"
                                    defaultValue={currTask.content}
                                />
                                <Button type="submit" className="mt-6">
                                    Update
                                </Button>
                            </form>
                        </div>
                    </DialogContent>
                </Dialog>
            </form>
            <form
                action={async () => {
                    await delete_note(currTask.id);
                }}
            >
                <Button variant={'destructive'}>Delete</Button>
            </form>
        </div>
    );
};

export default Act;
```

> src/components/navbar.tsx

```tsx
import { Button } from '@/components/ui/button';
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuSeparator,
    DropdownMenuTrigger
} from '@/components/ui/dropdown-menu';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { CircleUser, Menu, NotebookPen, Package2 } from 'lucide-react';
import Link from 'next/link';
import { ModeToggle } from './themeswitcher';

const Navbar = () => {
    return (
        <>
            <header className="sticky top-0 flex h-16 items-center gap-4 border-b bg-background px-4 md:px-6">
                <nav className="hidden flex-col gap-6 text-lg font-medium md:flex md:flex-row md:items-center md:gap-5 md:text-sm lg:gap-6">
                    <Link
                        href="#"
                        className="flex items-center gap-2 text-lg font-semibold md:text-base"
                    >
                        <NotebookPen className="h-6 w-6" />
                        <span className="sr-only">Acme Inc</span>
                    </Link>
                    <Link
                        href="/"
                        className="text-foreground transition-colors hover:text-foreground"
                    >
                        NotesApp
                    </Link>
                </nav>
                <Sheet>
                    <SheetTrigger asChild>
                        <Button
                            variant="outline"
                            size="icon"
                            className="shrink-0 md:hidden"
                        >
                            <Menu className="h-5 w-5" />
                            <span className="sr-only">
                                Toggle navigation menu
                            </span>
                        </Button>
                    </SheetTrigger>
                    <SheetContent side="left">
                        <nav className="grid gap-6 text-lg font-medium">
                            <Link
                                href="#"
                                className="flex items-center gap-2 text-lg font-semibold"
                            >
                                <Package2 className="h-6 w-6" />
                                <span className="sr-only">Acme Inc</span>
                            </Link>
                            <Link
                                href="#"
                                className="text-muted-foreground hover:text-foreground"
                            >
                                Dashboard
                            </Link>
                            <Link
                                href="#"
                                className="text-muted-foreground hover:text-foreground"
                            >
                                Orders
                            </Link>
                            <Link
                                href="#"
                                className="text-muted-foreground hover:text-foreground"
                            >
                                Products
                            </Link>
                            <Link
                                href="#"
                                className="text-muted-foreground hover:text-foreground"
                            >
                                Customers
                            </Link>
                            <Link href="#" className="hover:text-foreground">
                                Settings
                            </Link>
                        </nav>
                    </SheetContent>
                </Sheet>
                <div className="flex w-full items-center gap-4 md:ml-auto md:gap-2 lg:gap-4">
                    <div className="ml-auto flex flex-1 sm:flex-initial gap-3">
                        <ModeToggle />
                        <DropdownMenu>
                            <DropdownMenuTrigger asChild>
                                <Button
                                    variant="secondary"
                                    size="icon"
                                    className="rounded-full"
                                >
                                    <CircleUser className="h-5 w-5" />
                                    <span className="sr-only">
                                        Toggle user menu
                                    </span>
                                </Button>
                            </DropdownMenuTrigger>
                            <DropdownMenuContent align="end">
                                <DropdownMenuLabel>
                                    My Account
                                </DropdownMenuLabel>
                                <DropdownMenuSeparator />
                                <DropdownMenuItem>Logout</DropdownMenuItem>
                            </DropdownMenuContent>
                        </DropdownMenu>
                    </div>
                </div>
            </header>
        </>
    );
};

export default Navbar;
```

> src/components/noteform.tsx

```tsx
'use client';

import create_note from '@/actions/create_note';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Textarea } from './ui/textarea';
import { useRef } from 'react';

export function NoteForm() {
    const formRef = useRef(null);
    return (
        <Card className="w-[350px]">
            <CardHeader>
                <CardTitle>Add a Note</CardTitle>
            </CardHeader>
            <CardContent>
                <form
                    ref={formRef}
                    id="myForm"
                    action={async (formData: FormData) => {
                        await create_note(formData);
                        // @ts-ignore
                        formRef.current?.reset();
                    }}
                >
                    <div className="grid w-full items-center gap-4">
                        <div className="flex flex-col space-y-1.5">
                            <Textarea
                                placeholder="Type your message here."
                                name="content"
                            />
                        </div>
                        <Button type="submit">Add Note</Button>
                    </div>
                </form>
            </CardContent>
        </Card>
    );
}
```

> src/components/them-provider.tsx

```tsx
'use client';

import { ThemeProvider as NextThemesProvider } from 'next-themes';
import { type ThemeProviderProps } from 'next-themes/dist/types';

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
    return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
```

> src/actions/create_note.ts

```ts
'use server';
import prisma from '@/utils/db';
import { revalidatePath } from 'next/cache';

const create_note = async (formData: FormData) => {
    console.log('Enterd!');
    const content = formData.get('content') as string;
    await prisma.task.create({ data: { content } });
    revalidatePath('/');
};

export default create_note;
```

> src/actions/update_note.ts

```ts
'use server';
import prisma from '@/utils/db';
import { revalidateTag } from 'next/cache';

const update_note = async (formData: FormData, id: string) => {
    const content = formData.get('content') as string;
    await prisma.task.update({ where: { id }, data: { content } });
    revalidateTag('/');
};

export default update_note;
```

> src/actions/delete_note.ts

```ts
'use server';
import prisma from '@/utils/db';
import { revalidateTag } from 'next/cache';

const delete_note = async (id: string) => {
    await prisma.task.delete({ where: { id } });
    revalidateTag('/');
};

export default delete_note;
```

> src/actions/getall_note.ts

```ts
'use server';
import prisma from '@/utils/db';

const get_all_notes = async () => {
    const tasks = await prisma.task.findMany({
        orderBy: {
            createdAt: 'desc'
        }
    });
    return tasks;
};

export default get_all_notes;
```

### Adding Redux

**Create Store**

> /lib/store.ts

```ts
import { configureStore } from '@reduxjs/toolkit';

export const makeStore = () => {
    return configureStore({
        reducer: {}
    });
};

// Infer the type of makeStore
export type AppStore = ReturnType<typeof makeStore>;

// Infer the `RootState` and `AppDispatch` types from the store itself
export type RootState = ReturnType<AppStore['getState']>;
export type AppDispatch = AppStore['dispatch'];
```

> /lib/hooks.ts

```ts
import { useDispatch, useSelector, useStore } from 'react-redux';
import type { RootState, AppDispatch, AppStore } from './store';

// Use throughout your app instead of plain `useDispatch` and `useSelector`
export const useAppDispatch = useDispatch.withTypes<AppDispatch>();
export const useAppSelector = useSelector.withTypes<RootState>();
export const useAppStore = useStore.withTypes<AppStore>();
```

> app/StoreProvider.tsx
